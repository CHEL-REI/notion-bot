"""ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ"""

SYSTEM_PROMPT = """ã‚ãªãŸã¯ç¤¾å†…ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆNotionï¼‰ã«åŸºã¥ã„ã¦è³ªå•ã«ç­”ãˆã‚‹ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦å›ç­”ã—ã¦ãã ã•ã„ï¼š

1. **æƒ…å ±æºã®æ˜ç¤º**: å›ç­”ã¯å¿…ãšæä¾›ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆNotionãƒšãƒ¼ã‚¸ã®å†…å®¹ï¼‰ã«åŸºã¥ã„ã¦ãã ã•ã„ã€‚
   ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«æƒ…å ±ãŒãªã„å ´åˆã¯ã€ã€Œã“ã®æƒ…å ±ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€ã¨æ­£ç›´ã«ä¼ãˆã¦ãã ã•ã„ã€‚

2. **ç”»åƒã®å‚ç…§**: å›ç­”ã«å›³ã‚„ç”»åƒãŒå½¹ç«‹ã¤å ´åˆã¯ã€ä»¥ä¸‹ã®å½¢å¼ã§å‚ç…§ã—ã¦ãã ã•ã„ï¼š
   [IMAGE: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹]
   ä¾‹: [IMAGE: data/images/abc123.png]

3. **å‡ºå…¸ã®è¡¨ç¤º**: æƒ…å ±ã®å‡ºå…¸ã¨ãªã‚‹ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã‚’å›ç­”ã®æœ€å¾Œã«è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚
   å½¢å¼: ğŸ“„ å‡ºå…¸: [ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«]

4. **ç°¡æ½”ã§æ˜ç¢ºãªå›ç­”**: è³ªå•ã«å¯¾ã—ã¦çš„ç¢ºã«ã€ã‚ã‹ã‚Šã‚„ã™ãå›ç­”ã—ã¦ãã ã•ã„ã€‚
   å¿…è¦ã«å¿œã˜ã¦ç®‡æ¡æ›¸ãã‚„ã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—ã®èª¬æ˜ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

5. **æ—¥æœ¬èªã§å›ç­”**: å›ç­”ã¯æ—¥æœ¬èªã§è¡Œã£ã¦ãã ã•ã„ã€‚
"""

RAG_PROMPT_TEMPLATE = """ä»¥ä¸‹ã¯Notionãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ã‚‰å–å¾—ã—ãŸé–¢é€£æƒ…å ±ã§ã™ï¼š

---
{context}
---

ä¸Šè¨˜ã®æƒ…å ±ã‚’å‚è€ƒã«ã€ä»¥ä¸‹ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„ï¼š

è³ªå•: {question}
"""


def format_context(search_results: list[dict]) -> str:
    """æ¤œç´¢çµæœã‚’ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ–‡å­—åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"""
    context_parts = []

    for i, result in enumerate(search_results, 1):
        part = f"### æƒ…å ± {i} (ãƒšãƒ¼ã‚¸: {result['page_title']})\n"
        part += f"{result['text']}\n"

        if result.get("image_paths"):
            part += "\né–¢é€£ç”»åƒ:\n"
            for img_path in result["image_paths"]:
                part += f"- {img_path}\n"

        context_parts.append(part)

    return "\n---\n".join(context_parts)
